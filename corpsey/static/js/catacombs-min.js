$.corpsey=$.corpsey||{},$.corpsey.catacombs=function(){function t(){if(h(),v=f.getState(),x=$("#catacombs"),i(),k)b.push(g[0]),$(".comic.single:not(.uturn)").each((function(){_.push(parseInt($(this).attr("data-comic-id")))}));else for(var t=0;t<g.length;t++)_.push(g[t]);f.replaceState({direction:""},document.title,window.location.pathname),f.Adapter.bind(window,"statechange",(function(){v=f.getState(),i(),c(),n(),$.corpsey.trackPage()})),x.isotope({itemSelector:"img,h1",transitionDuration:300,stagger:35}).on("layoutComplete",(function(){j&&clearTimeout(j),j=setTimeout($.corpsey.catacombs.build_titles,300)})).isotope({filter:e()}),u(),$("#content").on("click","a.prev,a.next",(function(t){if(t.preventDefault(),$(".comic-nav").hasClass("loading"))return!1;$(".comic-nav").addClass("loading");var e=$(this).hasClass("next")?"next":"prev",i=$(this).attr("href"),c=$(this).attr("title")+" : The Infinite Corpse";return f.pushState({direction:e},c,i),!1})),$("#content").on("click","a.up",(function(t){return t.preventDefault(),$(".comic-nav").hasClass("loading")||($(".comic-nav").addClass("loading"),f.back()),!1})),$(document).on("keydown",(function(t){t.metaKey||(39===t.keyCode?($(".next.button:first").trigger("click"),t.preventDefault()):37===t.keyCode&&($(".prev.button:first").trigger("click"),t.preventDefault()))}))}function e(){var t=".comic.active img";return z?t=".comic.active img:not(.uturn-pad),.comic.active h1":T&&(t=".comic.active img:not(.uturn-pad)"),t}function i(){g=v.url.replace(location.host,"").match(/\d+/g);for(var t=0;t<g.length;t++)g[t]=parseInt(g[t]);if((k=null!==v.url.match(/uturn/))&&1==g.length){var e=parseInt($(".comic.uturn.active").attr("data-portal-to-id"));g[1]=e,w=!0}else w=!1;x.toggleClass("one-comic-showing",1===g.length),x.toggleClass("is-uturn",k)}function c(){if(_.length>15){$(".comic.single:not(.uturn)[data-comic-id="+_[0]+"]").remove();var t=$.inArray(_[0],_);_.splice(t,1)}}function n(){for(var t=0;t<g.length;t++)k&&0===t&&b.indexOf(g[t])<0?$.get("/ajax/get_uturn_panel/",{uturn_id:g[t],direction:v.data.direction}).done((function(t){o(t)})):k&&1===t&&_.indexOf(g[t])<0||!k&&_.indexOf(g[t])<0?$.get("/ajax/get_comic_panels/",{comic_id:g[t],direction:v.data.direction}).done((function(t){t.success&&a(t)})):($(".comic.single[data-comic-id="+g[t]+"]").addClass("active"),r())}function o(t){b.push(t.uturn.uturn_id);var e=$($.corpsey.render_template("uturn_single",t.uturn));x.append(e),x.isotope("appended",e),r()}function a(t){_.push(t.comic.comic_id);var e=$($.corpsey.render_template("comic_single",t.comic));"next"===t.direction?x.append(e).isotope("appended",e):x.prepend(e).isotope("prepended",e)}function r(){$("h1.comic_1,h1.comic_2").removeClass("active"),i();var t=[];if($("#catacombs .comic.single.active").each((function(){var e=parseInt($(this).data("comic-id"));t.push(e)})),!k&&t[0]!==g[0]||k&&w&&t[0]!==g[0]?$(".comic.active[data-comic-id="+g[0]+"]:first").after($(".comic.active[data-comic-id="+g[1]+"]:first")):k&&!w&&t[0]===g[0]&&$(".comic.active[data-comic-id="+g[1]+"]:first").after($(".comic.active[data-comic-id="+g[0]+"]:first")),$("#catacombs .comic.single").each((function(){k?($(this).hasClass("uturn")&&$(this).data("comic-id")!==g[0]||!$(this).hasClass("uturn")&&$(this).data("comic-id")!==g[1])&&$(this).removeClass("active"):($(this).hasClass("uturn")||$.inArray($(this).data("comic-id"),g)<0)&&$(this).removeClass("active")})),x.isotope({filter:e()}),T||z)if("next"===v.data.direction){var c=z?960:320;z&&k&&w&&(c=340),setTimeout((function(){$("html,body").animate({scrollTop:c})}),250)}else setTimeout((function(){$("html,body").animate({scrollTop:z?40:30})}),250);x.isotope(),i(),s()}function s(){"NaN"!=g[0]&&(y[g.join("-")]?d(y[g.join("-")]):$.get("/ajax/get_nav_links/",{comic_id_arr:g,is_uturn:k?1:""}).done((function(t){y[g.join("-")]=t,d(t)})))}function d(t){var e;$(".comic-nav").remove(),t.next_comic_links.length>0?(e=$.corpsey.render_template("next_comic_nav",t),$("#content").append(e)):t.uturn_links.length>0&&(e=$.corpsey.render_template("uturn_nav",t.uturn_links[0]),$("#content").append(e)),t.prev_comic_links.length>0&&(e=$.corpsey.render_template("prev_comic_nav",t),$("#content").append(e))}function u(){$("h1.comic_1, h1.comic_2").remove(),$(".comic.single.active").each((function(t){var e=$(this).find("h1").html();$("<h1 />").html(e).addClass("comic_"+(t+1)).appendTo("body").css({top:-1e3}).addClass("active")})),l()}function l(){$(".comic.single.active").each((function(t){var e=1===t&&x.width()<980?"1":"0";k&&$(this).hasClass("uturn")&&x.width()<980&&(e="1");var i,c=$(this).find("img:eq("+e+")").offset(),n=$("h1.comic_"+(t+1));n.length>0&&null!==c&&n.css({top:c.top+n.width(),left:c.left-16})})),$("h1.comic_1, h1.comic_2").show()}function m(){h(),l()}function p(){}function h(){var t=document.documentElement.clientWidth;T=t<=1020,z=t<=700}var f=window.History,v=f.getState(),g=[],_=[],y=[],C=15,b=[],k=!1,w=!1,x,T=!1,z=!1,j;return{init:t,resize:m,delayed_resize:p,build_titles:u}}(),$(document).ready((function(){$.corpsey.catacombs.init()})),$(window).resize((function(){$.corpsey.catacombs.resize(),!1!==$.corpsey.catacombs.delayed_resize_timer&&clearTimeout($.corpsey.catacombs.delayed_resize_timer),$.corpsey.catacombs.delayed_resize_timer=setTimeout($.corpsey.catacombs.delayed_resize,200)}));